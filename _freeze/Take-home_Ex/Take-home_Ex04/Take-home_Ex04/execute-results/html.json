{
  "hash": "075e32dce07c4e7cf8134c8e5262d9ea",
  "result": {
    "markdown": "---\ntitle: \"Take-home Exercise 4 ：Prototyping Modules for Be Weatherwise or Otherwise\"\nauthor: \"Zhang Shujie (Suzy)\"\ndate: \"March 8,2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  freeze: true\n  warning: false\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\neditor: visual\n---\n\n\n# **1 Overview**\n\n# **2 Data Preparation**\n\n## **2.1 Loading R Packages**\n\nIn this take-home exercise, the key R package use is [tmap](https://cran.r-project.org/web/packages/tmap/) package in R. Beside tmap package, four other R packages will be used. They are:\n\n-   [**readr**](https://readr.tidyverse.org/) for importing delimited text file,\n\n-   [**tidyr**](https://tidyr.tidyverse.org/) for tidying data\n\n-   [**dplyr**](https://dplyr.tidyverse.org/) for wrangling data\n\n-   [**sf**](https://cran.r-project.org/web/packages/sf/) for handling geospatial data.\n\nAmong the four packages, readr, tidyr and dplyr are part of tidyverse package.\n\nThe code chunk below will be used to install and load these packages in RStudio.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tmap, tidyverse, readxl, leaflet)\n```\n:::\n\n\n## **2.2 Importing Data**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweather_data <- read.csv(\"data/weather_data.csv\")\nstation_records <- read_excel(\"data/station_records.xlsx\")\n```\n:::\n\n\n## **2.3 Summary Statistics of Data**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(weather_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t204464 obs. of  13 variables:\n $ Station                      : chr  \"Paya Lebar\" \"Paya Lebar\" \"Paya Lebar\" \"Paya Lebar\" ...\n $ Year                         : int  2014 2014 2014 2014 2014 2014 2014 2014 2014 2014 ...\n $ Month                        : int  1 1 1 1 1 1 1 1 1 1 ...\n $ Day                          : int  1 2 3 4 5 6 7 8 9 10 ...\n $ Daily.Rainfall.Total..mm.    : chr  \"0\" \"0\" \"2.2\" \"0.6\" ...\n $ Highest.30.min.Rainfall..mm. : chr  \"�\" \"�\" \"�\" \"�\" ...\n $ Highest.60.min.Rainfall..mm. : chr  \"�\" \"�\" \"�\" \"�\" ...\n $ Highest.120.min.Rainfall..mm.: chr  \"�\" \"�\" \"�\" \"�\" ...\n $ Mean.Temperature...C.        : chr  \"�\" \"�\" \"�\" \"�\" ...\n $ Maximum.Temperature...C.     : chr  \"29.5\" \"31.7\" \"31.1\" \"32.3\" ...\n $ Minimum.Temperature...C.     : chr  \"24.8\" \"25\" \"25.1\" \"23.7\" ...\n $ Mean.Wind.Speed..km.h.       : chr  \"15.8\" \"16.5\" \"14.9\" \"8.9\" ...\n $ Max.Wind.Speed..km.h.        : chr  \"35.3\" \"37.1\" \"33.5\" \"35.3\" ...\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(weather_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Station               Year          Month             Day       \n Length:204464      Min.   :2014   Min.   : 1.000   Min.   : 1.00  \n Class :character   1st Qu.:2016   1st Qu.: 3.000   1st Qu.: 8.00  \n Mode  :character   Median :2018   Median : 6.000   Median :16.00  \n                    Mean   :2018   Mean   : 6.457   Mean   :15.73  \n                    3rd Qu.:2021   3rd Qu.: 9.000   3rd Qu.:23.00  \n                    Max.   :2024   Max.   :12.000   Max.   :31.00  \n                    NA's   :425    NA's   :425      NA's   :425    \n Daily.Rainfall.Total..mm. Highest.30.min.Rainfall..mm.\n Length:204464             Length:204464               \n Class :character          Class :character            \n Mode  :character          Mode  :character            \n                                                       \n                                                       \n                                                       \n                                                       \n Highest.60.min.Rainfall..mm. Highest.120.min.Rainfall..mm.\n Length:204464                Length:204464                \n Class :character             Class :character             \n Mode  :character             Mode  :character             \n                                                           \n                                                           \n                                                           \n                                                           \n Mean.Temperature...C. Maximum.Temperature...C. Minimum.Temperature...C.\n Length:204464         Length:204464            Length:204464           \n Class :character      Class :character         Class :character        \n Mode  :character      Mode  :character         Mode  :character        \n                                                                        \n                                                                        \n                                                                        \n                                                                        \n Mean.Wind.Speed..km.h. Max.Wind.Speed..km.h.\n Length:204464          Length:204464        \n Class :character       Class :character     \n Mode  :character       Mode  :character     \n                                             \n                                             \n                                             \n                                             \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 预处理数据：将所有列转换为字符型并替换空字符串以及特殊字符为NA\ndata_processed <- weather_data %>%\n  mutate(across(everything(), as.character)) %>%  # 将所有列转换为字符型\n  mutate(across(everything(), ~na_if(.x, \"\"))) %>%  # 将空字符串替换为NA\n  mutate(across(everything(), ~na_if(.x, \"�\")))  # 将特殊字符替换为NA\n\n# 计算每个站点的缺失值总数\nmissing_values_by_station <- data_processed %>%\n  group_by(Station) %>%\n  summarise(across(everything(), ~sum(is.na(.), na.rm = TRUE), .names = \"missing_{.col}\")) %>%\n  mutate(TotalMissing = rowSums(select(., starts_with(\"missing\")))) %>%\n  select(Station, TotalMissing) %>%\n  arrange(desc(TotalMissing))\n\nmissing_values_by_station <- missing_values_by_station %>%\n  mutate(across(everything(), ~ifelse(is.na(.), \"-\", .)))\n\nmissing_values_by_station\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 63 × 2\n   Station                TotalMissing\n   <chr>                         <dbl>\n 1 Serangoon                     13078\n 2 Yishun                        12271\n 3 Pasir Ris (West)              12247\n 4 Kent Ridge                    12170\n 5 Upper Peirce Reservoir        11898\n 6 Ulu Pandan                    11858\n 7 Bukit Panjang                 11836\n 8 Upper Thomson                 11830\n 9 Macritchie Reservoir          11803\n10 Marine Parade                 11667\n# ℹ 53 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 将'Mean.Temperature...C.'列中的非数值替换为NA，并转换为数值类型\nweather_data <- weather_data %>%\n  mutate(`Mean.Temperature...C.` = na_if(`Mean.Temperature...C.`, \"-\")) %>%\n  mutate(Mean_Temperature_C = as.numeric(`Mean.Temperature...C.`))\n\n# 选择一个数据较全面的月份，这里以2023年1月为例\nweather_data_january <- weather_data %>%\n  filter(Year == 2023, Month == 1, !is.na(Mean_Temperature_C))\n\n# 计算每个站点在2023年1月的平均气温\naverage_temperatures_january <- weather_data_january %>%\n  group_by(Station) %>%\n  summarise(Avg_Temp_January = mean(Mean_Temperature_C, na.rm = TRUE)) %>%\n  ungroup()\n\n# 将平均气温数据与站点地理位置信息合并\ndata_merged <- merge(station_records, average_temperatures_january, by = \"Station\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 创建颜色映射函数，使用反转的viridis颜色板\ncolorPalette <- colorNumeric(palette = rev(viridis::viridis(256)), domain = data_merged$Avg_Temp_January)\n\nm <- leaflet(data_merged) %>%\n  addTiles() %>%  # 添加默认的地图图块\n  addCircleMarkers(\n    ~Longitude, ~Latitude,\n    radius = 7,  # 设置固定大小的半径值\n    popup = ~paste(Station, \"January 2023 Avg. Temp:\", Avg_Temp_January, \"°C\"),  # 弹出窗口内容\n    fillColor = ~colorPalette(Avg_Temp_January),  # 根据平均气温映射颜色\n    fillOpacity = 0.7,  # 填充颜色的不透明度\n    color = \"black\",  # 圆圈的边框颜色\n    weight = 1  # 圆圈的边框宽度\n  ) %>%\n  addLegend(\n    position = \"topright\",  # 图例位置\n    title = \"Avg. Temp (°C)\",  # 图例标题\n    pal = colorPalette,  # 颜色映射函数\n    values = ~Avg_Temp_January,  # 依据的值\n    opacity = 0.7,  # 图例标记的不透明度\n    labFormat = labelFormat(suffix = \"°C\")  # 标签格式\n  )\n\n\n# 显示地图\nm\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"leaflet html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-ec45fbf77f02dbf5e3f2\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ec45fbf77f02dbf5e3f2\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"&copy; <a href=\\\"https://openstreetmap.org/copyright/\\\">OpenStreetMap<\\/a>,  <a href=\\\"https://opendatacommons.org/licenses/odbl/\\\">ODbL<\\/a>\"}]},{\"method\":\"addCircleMarkers\",\"args\":[[1.4439,1.3764,1.3678,1.3729,1.3337,1.3134,1.3455,1.2542,1.3106,1.281,1.3524,1.4168,1.4166,1.189,1.4252,1.25,1.3399,1.3858,1.2938],[103.7854,103.8492,103.9826,103.7224,103.7768,103.9619,103.6806,103.6741,103.8365,103.754,103.9007,103.9673,103.8654,103.768,103.8202,103.8279,103.8878,103.7114,103.6184],7,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":1,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#70CF57\",\"#22A785\",\"#1F998A\",\"#2AB07F\",\"#48C16E\",\"#440154\",\"#F5E61F\",\"#365C8D\",\"#48C16E\",\"#375B8D\",\"#2E6D8E\",\"#FDE725\",\"#1F9F88\",\"#375A8C\",\"#50C46A\",\"#482173\",\"#2C718E\",\"#CBE11E\",\"#1F978B\"],\"fillOpacity\":0.7},null,null,[\"Admiralty January 2023 Avg. Temp: 26.2709677419355 °C\",\"Ang Mo Kio January 2023 Avg. Temp: 26.4741935483871 °C\",\"Changi January 2023 Avg. Temp: 26.5354838709677 °C\",\"Choa Chu Kang (South) January 2023 Avg. Temp: 26.4322580645161 °C\",\"Clementi January 2023 Avg. Temp: 26.3516129032258 °C\",\"East Coast Parkway January 2023 Avg. Temp: 27.1107142857143 °C\",\"Jurong (West) January 2023 Avg. Temp: 26.0551724137931 °C\",\"Jurong Island January 2023 Avg. Temp: 26.8032258064516 °C\",\"Newton January 2023 Avg. Temp: 26.351724137931 °C\",\"Pasir Panjang January 2023 Avg. Temp: 26.8064516129032 °C\",\"Paya Lebar January 2023 Avg. Temp: 26.7322580645161 °C\",\"Pulau Ubin January 2023 Avg. Temp: 26.04 °C\",\"Seletar January 2023 Avg. Temp: 26.5096774193548 °C\",\"Semakau Island January 2023 Avg. Temp: 26.8137931034483 °C\",\"Sembawang January 2023 Avg. Temp: 26.3333333333333 °C\",\"Sentosa Island January 2023 Avg. Temp: 27.0137931034483 °C\",\"Tai Seng January 2023 Avg. Temp: 26.7129032258065 °C\",\"Tengah January 2023 Avg. Temp: 26.1225806451613 °C\",\"Tuas South January 2023 Avg. Temp: 26.544 °C\"],null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addLegend\",\"args\":[{\"colors\":[\"#FDE725 , #9BD93C 14.9432955303536%, #34B679 33.6224149432958%, #228B8D 52.3015343562377%, #365D8D 70.9806537691797%, #482576 89.6597731821219%, #440154 \"],\"labels\":[\"26.2°C\",\"26.4°C\",\"26.6°C\",\"26.8°C\",\"27.0°C\"],\"na_color\":null,\"na_label\":\"NA\",\"opacity\":0.7,\"position\":\"topright\",\"type\":\"numeric\",\"title\":\"Avg. Temp (°C)\",\"extra\":{\"p_1\":0.149432955303536,\"p_n\":0.8965977318212189},\"layerId\":null,\"className\":\"info legend\",\"group\":null}]}],\"limits\":{\"lat\":[1.189,1.4439],\"lng\":[103.6184,103.9826]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 检查合并后的数据集中有多少个独特的站点\nunique_stations <- unique(data_merged$Station)\nnum_unique_stations <- length(unique_stations)\n\n# 打印站点数量\nprint(num_unique_stations)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 19\n```\n:::\n\n```{.r .cell-code}\n# 如果需要查看哪些站点被包括了，可以打印unique_stations\nprint(unique_stations)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Admiralty\"             \"Ang Mo Kio\"            \"Changi\"               \n [4] \"Choa Chu Kang (South)\" \"Clementi\"              \"East Coast Parkway\"   \n [7] \"Jurong (West)\"         \"Jurong Island\"         \"Newton\"               \n[10] \"Pasir Panjang\"         \"Paya Lebar\"            \"Pulau Ubin\"           \n[13] \"Seletar\"               \"Semakau Island\"        \"Sembawang\"            \n[16] \"Sentosa Island\"        \"Tai Seng\"              \"Tengah\"               \n[19] \"Tuas South\"           \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-binding-2.2.1/leaflet.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}